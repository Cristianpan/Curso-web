let paso=1;const cita={usuarioId:"",nombre:"",fecha:"",hora:"",servicios:[]};function iniciarApp(){tabs(),paginaAnterior(),paginaSiguiente(),consultarApi(),agregarDatosCliente(),obtenerHoraCita(),obtenerFechaCita()}function mostrarSeccion(){document.querySelector("#paso-"+paso).classList.add("mostrar")}function ocultarSeccion(){document.querySelector(".mostrar").classList.remove("mostrar")}function actualizarTab(){document.querySelector(".actual").classList.remove("actual");document.querySelector(`[data-paso = '${paso}']`).classList.add("actual")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{const t=parseInt(e.target.dataset.paso);paso!==t&&(paso=t,ocultarSeccion(),mostrarSeccion(),actualizarTab(),botonesPaginador())})})}function botonesPaginador(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");1===paso?(t.classList.remove("ocultar"),e.classList.add("ocultar")):3===paso?(e.classList.remove("ocultar"),t.classList.add("ocultar"),mostrarResumenCita()):(e.classList.remove("ocultar"),t.classList.remove("ocultar"))}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",()=>{paso--,ocultarSeccion(),mostrarSeccion(),actualizarTab(),botonesPaginador()})}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",()=>{paso++,ocultarSeccion(),mostrarSeccion(),actualizarTab(),botonesPaginador()})}async function consultarApi(){try{mostrarServicios(await(await fetch("/api/servicios")).json())}catch(e){console.log(e)}}function mostrarServicios(e){const t=document.createDocumentFragment();e.forEach(e=>{const{id:o,nombre:a,precio:n}=e,r=document.createElement("P");r.classList.add("nombre-nombreServicio"),r.textContent=a;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent="$"+n;const i=document.createElement("DIV");i.classList.add("servicio"),i.id=o,i.appendChild(r),i.appendChild(c),i.onclick=()=>{seleccionarServicio(e)},t.appendChild(i)}),document.querySelector("#servicios").appendChild(t)}function seleccionarServicio(e){const{servicios:t}=cita;document.getElementById(e.id).classList.toggle("seleccionado"),t.includes(e)?cita.servicios=t.filter(t=>t.id!==e.id):cita.servicios=[...t,e]}function agregarDatosCliente(){cita.nombre=document.querySelector("#nombre").value,cita.usuarioId=document.querySelector("#usuarioId").value}function obtenerHoraCita(){document.querySelector("#hora").addEventListener("input",e=>{const t=e.target.value.split(":");t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),t[0]<10||t[0]>=18&&t[1]>0?(mostrarError("El horario es de 10:00 a.m. a 6:00 p.m. Por favor seleccione otro horario",1),e.target.value=""):(cita.hora=e.target.value,ocultarError(1))})}function obtenerFechaCita(){document.querySelector("#fecha").addEventListener("input",e=>{const t=new Date(e.target.value).getUTCDay();0===t||6===t?(e.target.value="",mostrarError("Fines de semana no permitidos",0)):(cita.fecha=e.target.value,ocultarError(0))})}function mostrarError(e,t){const o=document.querySelectorAll(".field p");o[t].textContent=e,o[t].classList.add("error"),o[t].classList.remove("ocultar")}function ocultarError(e){const t=document.querySelectorAll(".field p");t[e].textContent="",t[e].classList.remove("error"),t[e].classList.add("ocultar")}function mostrarAlerta(e){const t=document.createElement("DIV"),o=document.createElement("P");document.querySelector(".contenido-resumen .modal")||(t.classList.add("modal"),t.classList.add("error"),o.textContent=e,t.appendChild(o),document.querySelector(".contenido-resumen").appendChild(t))}function ocultarAlerta(){const e=document.querySelector(".contenido-resumen .modal");e&&e.remove()}function mostrarResumenCita(){const e=document.querySelector(".contenido-resumen");Object.values(cita).includes("")||!cita.servicios.length?mostrarAlerta("Por favor llene el formulario y seleccione al menos un servicio."):(ocultarAlerta(),e.appendChild(generarResumenCita()),e.appendChild(generarBotonEnviarCita()))}function generarResumenCita(){const{nombre:e,fecha:t,hora:o,servicios:a}=cita,n=document.createDocumentFragment(),r=document.createElement("P");r.innerHTML="<span>Nombre:</span> "+e;const c=document.createElement("P");c.innerHTML="<span>Fecha:</span> "+formatearFecha(t);const i=document.createElement("P");i.innerHTML=`<span>Hora:</span> ${o} horas`;const s=document.createElement("H3");s.textContent="Resumen de servicios",n.appendChild(s),a.forEach(e=>{const{id:t,precio:o,nombre:a}=e,r=document.createElement("DIV");r.classList.add("contenedor-servicio");const c=document.createElement("P");c.textContent=a;const i=document.createElement("P");i.innerHTML="<span>Precio:</span> $"+o,r.appendChild(c),r.appendChild(i),n.appendChild(r)});const l=document.createElement("H3");return l.textContent="Resumen de Cita",n.appendChild(l),n.appendChild(r),n.appendChild(c),n.appendChild(i),n}function formatearFecha(e){const t=new Date(e),o=t.getMonth(),a=t.getDate()+2,n=t.getFullYear();return new Date(Date.UTC(n,o,a)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function generarBotonEnviarCita(){const e=document.createElement("DIV");e.classList.add("align-right");const t=document.createElement("BUTTON");return t.classList.add("button"),t.textContent="Reservar Cita",t.onclick=reservarCita,e.appendChild(t),e}async function reservarCita(){const{usuarioId:e,fecha:t,hora:o,servicios:a}=cita,n={usuarioId:e,fecha:t,hora:o};n.servicios=a.map(e=>e.id);try{const e=await fetch("/api/citas",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}),t=await e.json();console.log(t),t.ok&&(await Swal.fire({icon:"success",title:"Cita Creada",text:"Su cita ha sido creada correctamente",button:"Ok"}),setTimeout(()=>{window.location.reload()},3e3))}catch(e){console.log(e),Swal.fire({icon:"error",title:"Error",text:"Ha ocurrido un error al crear la cita.",button:"Ok"})}}document.addEventListener("DOMContentLoaded",()=>{iniciarApp()});